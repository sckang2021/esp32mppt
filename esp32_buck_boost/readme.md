![IMGP7715.JPG](image/image1.jpeg)
![IMGP7730.JPG](image/image2.jpeg)
# Super Dial 电机旋钮屏
##更新日志
### **重要更新2023/2/10:**

* **主控板V1更新为V2（打板 `不要打V1版本了）`，修复ip5306不稳定问题导致的电机转动时芯片重启、打开esp32wifi功能时供电不稳重启。 `删除USB引脚上的电容`（V1版本的C10、C11）让USB正常工作，原因是100nf电容太大了导致USB不能正常识别，去除电容就可以**
* **优化项：更换充电芯片使充电电流限制在400mA提高电池使用寿命，设计ups电路可实现USB和电池供电不间断切换，保证USB2.0也可以正常使用**
* **新的代码+固件也一并开源至Gitee**
* 硬件应该为最终版本，不再改动。代码会继续画饼

2022/10/10：原理图中usb5Vin 经过ip5036 再输出5v，会导致单usb供电的时候不稳定，会让电机控制或者蓝牙无法正常工作，暂时可以使用先usb和电池一起用。问题修复中，还没打板。
2022/11/11：发现程序之前mt6701磁编码器芯片用iic通信会有延迟现象，修改主控和电机驱动板的8p线走线，变成spi模式，磁编码器检测效果变好。不会出现力度突然大突然小的情况。（程序bin会后续修改，但是目前iic的程序可以在新版pcb上使用）

2022/11/24 修改bin文件，iic  -&gt; spi（老版本主控板不支持spi固件），替换力度控制功能为双击关机     spi固件已解决力度突然大突然小的问题，但是11.10之前版本的pcb不支持spi通信

## 1.项目介绍
灵感来源与国外的smart konb，制作初衷为制作一个桌面力反馈旋钮，可以与电脑进行交互。项目从最重要的电机入手，选择了量大便宜的3205电机（小米云台电机的库存货），在结构上实现上下等大，增加实用功能蓝牙hid（轮盘功能），可实现与surface dial一样的功能。演示视频[“SuperDial电机旋钮——力反馈、多功能”](https://www.bilibili.com/video/BV1cG411c7QS)
## 2.制作说明
硬件构成esp32s3-n16r8，屏幕为gc9a01，3个pcb，4个打印件，若干结构件。具体在附件——[附件gitee链接](https://gitee.com/coll45/super-dial-motor-knob-screen)

pcb：

1. 屏幕板，中间需要焊接铜柱（铜柱尖角对准线，可以用m2.5螺丝先固定后焊接，然后取出螺丝），8p0.8线通过铜柱往下连接到主控板（穿过电机中心，铜柱固定在打印件-适配器上）　<font color='red'> 下单屏幕板的时候注意备注： 不要半孔工艺</font>

![pingmu.png](image/pcb1.png)

2.电机驱动板，含磁编码器。驱动芯片eg2133，磁编码器MT6701。穿过屏幕8p线后，驱动板通过螺丝固定在打印件-适配器上
![qudong.png](image/pcb2.png)

3.主控板,固定在底座上，背面朝上，电池放底部。typec一定需要USB3.0，5V1A以上，可实现充电、单独给旋钮供电（未来可以支持usb-hid）主控板上的2.54插针都不要焊接。
![zhukong.png](image/pcb3.png)

## 结构说明
打印件可以通过三维猴打印，直接上传`3D打印和CNC模型-by虫二`文件夹内的stl即可，一共四个打印件（选择外壳cnc就用cnc的step）。不需要上传彩蛋，忽视壁厚小于0.8mm的警告，预计一套20-30。
![结构说明.png](image/assemble.png)

## 代码烧录
打开附件文件夹内的`bin/flash_download_tool_3.9.2.exe` 选择esp32s3，其他什么都不改（super_dial_v2.bin烧录到0x0位置）。然后通过usb-ttl连接到主控板，tx-rx rx-tx gnd -gnd，连接完成之后，按住boot按钮（sw1）然后接入typec亮起3.3v指示灯，然后松开boot按钮，点start开始烧录。烧录完成后拔掉typec 再次插入就可以看见效果

USB烧录方法：打开附件文件夹内的`bin/flash_download_tool_3.9.2.exe` 选择esp32s3，loadmod改成USB其他什么都不改（super_dial_v2.bin烧录到0x0位置），先按住boot键，然后USB数据线连接。点start开始烧录。烧录完成后拔掉typec 再次插入就可以看见效果

OTA烧录方法（只限于烧录过程序，但是想更新最新固件）：旋钮进入设置界面（wifi界面，有圆圈在转动的）然后连接esp32的wifi热点。连接成功后打开浏览器输入192.168.4.1进入界面选择文件夹/bin/OTA/ota_v2.bin。点击上传即可，上传过程中会出现转圈卡顿的情况表示正常上传，上传完成后会自动重启。
## 源码
已经上传至gitee，开发环境为arduino - esp32s3-n16r8（自己装arduino环境会有一些错误，需要自行解决，例如LVGL库需要修改配置文件）

## 未来计划（画饼）
项目初衷是做pc的外设所以打算都是开发pc功能。有能力大佬可以在开源的基础上自行修改。

1. ~~lvgl多级菜单实现多种界面效果（但是主要还是对pc设备win10系统的操作） ~~2023/2/10已实现
2. pc性能监视器
3. wifi webserver实现图片修改

## 沟通与交流
816782369（有CNC+SMT套件开车）

